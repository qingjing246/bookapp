<!DOCTYPE html>
<html lang="en" ng-app="app">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0"/>
    <meta name="format-detection" content="telephone=nio">
    <link rel="stylesheet" type="text/css" href="/stylesheets/reset.css">
    <link rel="stylesheet" href="/font-icon/iconfont.css"/>
    <title><%= info[0]._doc.title %></title>
    <style type="text/css">
        ul{
            list-style:none;
        }
        .clearfix:after,.clearfix:before{
            clear: both;
            content: "";
        }
        html{
            width: 100%;
            height: 100%;
            font-size: 62.5%;
        }
        a{
            text-decoration: none;
            color: #fff;
        }
        body,h4,li,ul,p{
            margin: 0;
            padding: 0;
        }
        body{
            display: none;
           /* background: #e9dfc7;*/

        }
        .container{
            position: relative;
            width:50rem;
            margin: 0 auto;
            overflow: hidden;
        }
        .iconfont{
            color:#fff;
        }
        .read-content{
            overflow:hidden;
            color:#555;
            padding: 1rem;
        }
        .read-content span{
            display: none;
        }
        .read-content hr{
            border-color:#736357;
        }
        .read-content h4{
            font-size:2rem;
            line-height: 4rem;
            color:#736357;

        }
        .read-content p{
            text-indent:3rem;
            margin:0.5rem 0;
            line-height:3rem;
            letter-spacing: 1px;
        }
        .tab{
            height:3rem;
            margin:1rem auto;
            line-height:3rem;
            border-radius: 0.5rem;
            border:1px solid #858382;
            font-size:2rem;
            background:#000;
            opacity:0.9;
        }
        .tab li{
            float:left;
            width:50%;
            color: #fff;
            text-align:center;
        }
        .tab li:nth-child(2){
            border-right:none;
        }
        .button-bar{
            width:70%;
            margin: 20px auto 40px;
        }
        .top-nav{
            position:fixed;
            top:0;
            height:5rem;
            width:50rem;
            z-index: 9999;
            background:#000;
            color:#fff;
        }
        .icon-back{
            display: inline-block;
            margin-top: 1.5rem;
            margin-left: 1.5rem;
            width: 2rem;
            height: 2rem;
            border-radius: 1rem;
            border:1px solid #afafaf;
            text-align: center;
            line-height: 2rem;
        }
        .icon-back i{
            font-size: 1.5rem;
        }
        .nav-title{
            font-size: 1.5rem;
            display:inline-block ;
            margin: 1.5rem 0 0 0.5rem;
        }

        .nav-pannel{
            position: fixed;
            bottom:70px;
            height:135px;
            width:50rem;
            background:rgba(0,0,0,0.9);
            color:#fff;
            z-index: 10000;
        }
        .child-mod{
            padding:0.5rem 1rem;
            margin:1.5rem;
        }
        .child-mod span{
            display: inline-block;
            padding-right:2rem;
            padding-left: 1rem;
            font-size: 1.5rem;
        }
        .font-size-button{
            background: none;
            border:1px solid #bcbcbc;
            color: #fff;
            border-radius: 16px;
            padding: 0.5rem 6rem;
            margin: 0 3rem;
            display: inline-block;
        }
        .child-mod:nth-child(2){

        }

        .bg-color{
            position: relative;
            height: 30px;
            width: 30px;
            border-radius: 15px;
            display: inline-block;
            vertical-align: -12px;
            margin-left: 20px;
        }
        .bg-border{
            position: absolute;
            height: 32px;
            width: 32px;
            border-radius: 16px;
            display: inline-block;
            vertical-align: -14px;
            margin-left: 10px;
            border: 1px #ff7800 solid;
            top: -2px;
            left: -12px;
        }
        .bg-color:nth-child(2){
            background: #f7eee5;
        }
        .bg-color:nth-child(3){
            background: #e9dfc7;
        }
        .bg-color:nth-child(4){
            background: #a4a4a4;
        }
        .bg-color:nth-child(5){
            background: #cdefce;
        }
        .bg-color:nth-child(6){
            background: #283548;
        }

        .background-color span{
            display: inline-block;
            font-size:1.5rem;
        }

        .nav-bottom{
            position:fixed;
            width:50rem;
            background: #000;
            bottom:0;
            height: 70px;
        }
        .nav-list{
            float: left;
            width: 33.3333%;
            text-align: center;
            margin: 0;
            line-height:70px;
        }
        .nav-list i{
            font-size: 3rem;
        }
        .nav-list span{
            color:#fff;
            font-size: 1.5rem;
        }
        .action-box{
            position: fixed;
            width: 50rem;
            height: 40%;
            top: 30%;
        }
        @media screen and (max-width:700px){
            .action-box{
                width: 100%;
            }
            .container{
                width: 100%;
            }
            .top-nav{
                width:100%;
            }
            .nav-pannel{
                width:100%;
            }
            .font-size-button{
                text-align: center;
                padding: 1rem 0;
                width: 30%;
                margin:0 1rem;
            }
            .nav-bottom{
                width: 100%;
            }
            .read-content{

            }
            .bg-color{
                margin-left: 10px;
            }
        }
        .addition{
            display: none;
        }
        #none{
            display: none;
        }
    </style>
</head>
<body>
<i id="none" class="iconfont icon-ziti1">
</i>
<div id="root" class="container">
    <div class="action-box" id="action_box">

    </div>
    <div id="top-nav" class="top-nav" style="display:none">
        <a href="/">
        <div class="icon-back">
            <i class="iconfont icon-yuyin"></i>
        </div>
        <div class="nav-title">返回首页</div>
        </a>
    </div>
    <div id="fiction_title">
    </div>
    <div id="fiction_container" class="read-content">
             <h4> <%= info[0]._doc.title%> </h4>
            <hr>
        <div id="txt-main">
            <%- info[0]._doc.content%>
        </div>

    </div>
    <div class="button-bar">
        <ul class="tab">
            <li id="prev_button">上一章</li>
            <li id="next_button">下一章</li>
        </ul>
    </div>
    <div class="nav-pannel" id="font-container" style="display:none">
        <div class="child-mod font-size">
            <span>字号</span>
            <div id="large-font" class="font-size-button">大</div>
            <div id="small-font" class="font-size-button">小</div>
        </div>
        <div class="child-mod">
            <span>背景</span>
            <div class="bg-color">
                <div class="bg-border" style="display:none"></div>
            </div>
            <div class="bg-color">
                <div class="bg-border" style="display:none"></div>
            </div>
            <div class="bg-color">
                <div class="bg-border" style="display:none"></div>
            </div>
            <div class="bg-color">
                <div class="bg-border" style="display:none"></div>
            </div>
            <div class="bg-color">
                <div class="bg-border" style="display:none"></div>
            </div>
        </div>
    </div>
    <div id="bottom_nav" class="nav-bottom" style="display:none">
      <div class="nav-list" id="ml_button">
          <a href="/booklist/?bookid=<%= info[0]._doc.bookid%>">
        <i class="iconfont icon-mulu1">
      </i>
      <span>
        目录
      </span></a></div>
      <div class="nav-list" id="font_button">
        <i class="iconfont icon-ziti1">
      </i>
      <span>
          字体
      </span></div>
      <div class="nav-list" id="day_button">
        <i id="day_icon" class="iconfont icon-yejian1">
      </i>
      <span id="day">
        夜间
      </span></div>
    </div>
</div>

<script type="text/javascript" src="/js/zepto.min.js"></script>

<script type="text/javascript">
    (function(){

        var Util = (function(){
            var prefix = 'html5_reader_';
            var StorageGetter = function(key){
                return localStorage.getItem(prefix + key);
            };
            var StorageSetter = function(key,val){
                return localStorage.setItem(prefix + key,val);
            };
            return {
                StorageGetter:StorageGetter,
                StorageSetter:StorageSetter
            }
        })();
        var Dom ={
            top_nav:$('#top-nav'),
            bottom_nav:$('#bottom_nav'),
            font_container:$('#font-container'),
            body:$('body'),
            read_container:$('#fiction_container'),
            bg_color:$('.bg-color')
        };

        var font_size = Util.StorageGetter('font_size');
        if(!font_size){
            font_size = 16;
        }

        var seva_color = Util.StorageGetter('bg-color');


        seva_color ? Dom.body.css('background',seva_color):Dom.body.css('background','#e9dfc7');

        var day = true;
        Dom.read_container.css('font-size',font_size + 'px');


        //入口函数
        function main (){
            EvenHanlder();
            ReaderModel();
        }
        //实现和阅读器相关数据交互方法
        function ReaderModel(){
            $('#prev_button').click(function (){
                if( '<%- info[0]._doc.id%>'== 1){
                    alert("没有上一页了");

                }else{
                    window.location.href = '?bookid=<%- info[0]._doc.bookid%>&id='+(<%- info[0]._doc.id%>-1);
                }

            });
            $('#next_button').click(function (){
                if( '<%- info[0]._doc.id%>' ){
                    console.log(<%- info[0]._doc.id%>);
                    window.location.href = '?bookid=<%- info[0]._doc.bookid%>&id='+(<%- info[0]._doc.id%>+1);
                }else{
                    alert("已到最后一页");
                }

            })
        }



        //交互事件绑定
        function EvenHanlder(){

            //点击中心区域显示消失上下状态栏
            $('#action_box').click(function(){
               // Dom.top_nav.toggle();
                if( Dom.top_nav.css('display') == 'none'){
                    Dom.top_nav.show();
                }else{
                    Dom.top_nav.hide();
                }
                Dom.bottom_nav.toggle();
                Dom.font_container.hide();
                $('.icon-ziti1').css('color','#fff');
            });

            //目录栏
            $('#ml_button').click(function(){

            });

            //字体背景栏
            $('#font_button').click(function(){
                Dom.font_container.toggle();
                if(Dom.font_container.css('display') !=='none' ){
                    $('.icon-ziti1').css('color','#ff7800')
                }else{
                    $('.icon-ziti1').css('color','#fff')
                }
            });

            //字体放大
            $('#large-font').click(function(){
                font_size += 1;
                if(font_size > 20){
                    font_size = 20;
                }
                Dom.read_container.css('font-size',font_size + 'px');
                Util.StorageSetter('font_size',font_size);
            });

            //字体缩小
            $('#small-font').click(function(){
                font_size -= 1;
                if(font_size < 10){
                    font_size = 10;
                }
                Dom.read_container.css('font-size',font_size + 'px');
                Util.StorageSetter('font_size',font_size);
            });

            //背景切换
            //字体和背景的颜色表
            var colorArr = [{
                value : '#f7eee5',
                name : '米白',
                font : ''
            }, {
                value : '#e9dfc7',
                name : '纸张',
                font : '',
                id : "font_normal"
            }, {
                value : '#a4a4a4',
                name : '浅灰',
                font : ''
            }, {
                value : '#cdefce',
                name : '护眼',
                font : ''
            }, {
                value : '#283548',
                name : '灰蓝',
                font : '#7685a2',
                bottomcolor : '#fff'
            }];

            for(var i= 0;i<colorArr.length;i++){
                console.log(colorArr[i].value);
                $(Dom.bg_color[i]).attr("color-data",colorArr[i].value);
            }

            Dom.bg_color.click(function(){
                $('.bg-color').attr('id','');
                $('.bg-border').css('display','none');
                $(this).attr('id','font_normal');
                $('#font_normal .bg-border').css('display','');
                Dom.body.css('background',$(this).attr('color-data'));
                Dom.read_container.css('color','#000');
                Util.StorageSetter('bg-color',$(this).attr('color-data'))
            });

            //日夜切换
            $('#day_button').click(function(){
                if(day){
                    Dom.body.css('background','#283548');
                    Dom.read_container.css('color','#B3B3B3');
                    $('#day').text('白天');
                    $('#day_icon').removeClass('icon-yejian1').addClass('icon-qingbaitian');
                    day = false;
                }else{
                    Dom.body.css('background','#e9dfc7');
                    Dom.read_container.css('color','#000');
                    $('#day').text('夜间');
                    $('#day_icon').removeClass('icon-qingbaitian').addClass('icon-yejian1');
                    day = true;
                }
            });

            //滚动条事件
            $(window).scroll(function(){
                Dom.top_nav.hide();
                Dom.bottom_nav.hide();
                Dom.font_container.hide();
                $('.icon-ziti1').css('color','#fff');

            });

            Dom.body.show();
        }

        main();
    })();
</script>
</body>

</html>
